import streamlit as st
import urllib.parse
import requests
from datetime import datetime

# --- ุฅุนุฏุงุฏุงุช ุฃุณุงุณูุฉ ---
SCRIPT_URL = "ุถุน_ุฑุงุจุท_ุงูู_WEB_APP_ููุง"
RECEIVING_NUMBER = "9613220893"

st.set_page_config(page_title="ุดุฑูุฉ ุญูุจุงูู ุฅุฎูุงู", layout="wide")

# ุชุตููู ุงููุงุฌูุฉ
st.markdown("""
    <style>
    .stApp { background-color: #0E1117; }
    .category-header { 
        background-color: #e9ecef; color: #1E3A8A; padding: 8px 12px; border-radius: 5px; 
        font-weight: bold; font-size: 16px; margin-top: 15px; border-right: 5px solid #fca311; text-align: right;
    }
    .item-box { 
        display: inline-block; color: white !important; font-weight: bold !important; 
        font-size: 17px !important; background-color: #1E3A8A !important; 
        padding: 5px 12px; border-radius: 8px; text-align: right; min-width: 140px;
    }
    input { background-color: #ffffcc !important; color: black !important; font-weight: bold !important; height: 40px !important; font-size: 20px !important; }
    .header-box { background-color: #1E3A8A; color: white; text-align: center; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    .stButton button { background-color: #fca311; color: #1E3A8A !important; font-weight: bold; height: 50px; width: 100%; }
    .review-box { background-color: #1c212d; border: 1px solid #fca311; padding: 15px; border-radius: 10px; color: white; margin-bottom: 20px; }
    </style>
    """, unsafe_allow_html=True)

if 'page' not in st.session_state: st.session_state.page = 'home'
if 'cart' not in st.session_state: st.session_state.cart = []

def ar_to_en_num(text):
    ar_nums = 'ููกูขูฃูคูฅูฆูงูจูฉ'
    en_nums = '0123456789'
    return text.translate(str.maketrans(ar_nums, en_nums))

def render_list_final(items_list, key_suffix, weight_label):
    selections = []
    for item in items_list:
        if item.startswith("-"):
            st.markdown(f'<div class="category-header">{item[1:]}</div>', unsafe_allow_html=True)
        else:
            c1, c2 = st.columns([2.5, 1])
            with c1: st.markdown(f'<div class="item-box">{item}</div>', unsafe_allow_html=True)
            with c2:
                q = st.text_input("", key=f"{key_suffix}_{item}", label_visibility="collapsed", placeholder="0")
                if q:
                    q_en = ar_to_en_num(q)
                    if q_en.isdigit() and int(q_en) > 0:
                        full_name = f"{item} {weight_label}" if weight_label else item
                        selections.append({"item": full_name, "qty": q_en})
    return selections

# --- ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ---
if st.session_state.page == 'home':
    st.image("https://raw.githubusercontent.com/helbawibros/-/main/Logo%20.JPG", use_container_width=True)
    st.markdown('<div class="header-box"><h1>ูุธุงู ุทูุจูุงุช ุญูุจุงูู ุฅุฎูุงู</h1></div>', unsafe_allow_html=True)
    
    if st.session_state.cart:
        st.markdown('<div class="review-box"><h3>๐ ุงููุฑุงุฌุนุฉ ูุจู ุงูุฅุฑุณุงู:</h3>', unsafe_allow_html=True)
        for entry in st.session_state.cart:
            st.write(f"โข {entry['item']} : {entry['qty']}")
        
        c_send, c_clear = st.columns(2)
        with c_send:
            if st.button("๐ ุฅุฑุณุงู ุงูุทูุจูุฉ ุงูููุงุฆูุฉ"):
                now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                msg = "ุทูุจูุฉ ูุจูุนุงุช ุฌุฏูุฏุฉ:\n" + "-"*15 + "\n"
                for entry in st.session_state.cart:
                    msg += f"โข {entry['item']} : {entry['qty']}\n"
                whatsapp_url = f"https://api.whatsapp.com/send?phone={RECEIVING_NUMBER}&text={urllib.parse.quote(msg)}"
                st.markdown(f'<a href="{whatsapp_url}" target="_blank" style="background:#25d366;color:white;padding:15px;display:block;text-align:center;text-decoration:none;border-radius:10px;font-weight:bold;">ุชุฃููุฏ ูุงุชุณุงุจ โ</a>', unsafe_allow_html=True)
                st.session_state.cart = []
        with c_clear:
            if st.button("๐๏ธ ูุณุญ ุงููู"):
                st.session_state.cart = []
                st.rerun()
        st.markdown('</div>', unsafe_allow_html=True)

    c1, c2, c3 = st.columns(3)
    with c1:
        if st.button("๐พ ุงูุญุจูุจ"): st.session_state.page = 'grains'; st.rerun()
    with c2:
        if st.button("๐ถ๏ธ ุงูุจูุงุฑุงุช"): st.session_state.page = 'spices'; st.rerun()
    with c3:
        if st.button("๐ ุตูู ุฎุงุต"): st.session_state.page = 'special'; st.rerun()

# --- ุตูุญุฉ ุงูุญุจูุจ (ูุงููุฉ) ---
elif st.session_state.page == 'grains':
    st.markdown('<div class="header-box"><h2>๐พ ูููุฐุฌ ุงูุญุจูุจ</h2></div>', unsafe_allow_html=True)
    temp_sel = []
    
    with st.expander("๐ฆ ุชุนุจุฆุฉ 1000ุบ / 907ุบ"):
        temp_sel += render_list_final(["-ุญูุต", "ุญูุต ูกูข (907ุบ)", "ุญูุต ูฉ (907ุบ)", "ุญูุต ูุณุฑ (907ุบ)", "-ููู", "ููู ุญุจ (907ุบ)", "ููู ูุฌุฑูุด (1000ุบ)", "ููู ุนุฑูุถ (1000ุบ)", "-ูุงุตูููุง", "ูุงุตูููุง ุตููุจุฑูุฉ (907ุบ)", "ูุงุตูููุง ุญูุฑุง ุทูููุฉ (1000ุบ)", "ูุงุตูููุง ุญูุฑุง ูุฏุนุจูู (1000ุบ)", "ูุงุตูููุง ุนุฑูุถู (1000ุบ)", "-ุนุฏุณ", "ุนุฏุณ ุงุจูุถ ุฑููุน (907ุบ)", "ุนุฏุณ ุงุญูุฑ (907ุบ)", "ุนุฏุณ ููุฑุฏู/ุจูุฏู (907ุบ)", "ุนุฏุณ ุนุฑูุถ (907ุบ)", "-ุจุฑุบู", "ุจุฑุบู ุงุณูุฑ ูุงุนู (907ุบ)", "ุจุฑุบู ุงุณูุฑ ุฎุดู (907ุบ)", "ุจุฑุบู ุงุดูุฑ ูุงุนู (907ุบ)", "ุจุฑุบู ุงุดูุฑ ุฎุดู (907ุบ)", "ุจุฑุบู ุงุดูุฑ ุฒูุงุชู (907ุบ)", "-ุงุฑุฒ", "ุงุฑุฒ ูุตุฑู (907ุบ)", "ุงุฑุฒ ุฅูุทุงูู (907ุบ)", "ุงุฑุฒ amirki (907ุบ)", "ุงุฑุฒ ุจุณูุชู (907ุบ)", "ุงุฑุฒ ุนูุจุฑู (1000ุบ)", "ุงุฑุฒ ูุงุนู (907ุบ)", "-ุณูุฑ", "ุณูุฑ ุญุจ (907ุบ)", "ุณูุฑ ุงุณูุฑ (1000ุบ)", "ุณูุฑ ูุงุนู (1000ุบ)", "-ุทุญูู", "ุทุญูู ูุฑุฎุฉ (907ุบ)", "ุณููุฏ (907ุบ)", "ุบูุฏ ููุฏู (1000ุบ)", "ุบูุฏูุงุฑู (907ุบ)", "ุทุญูู ุฒูุฑู (1000ุบ)", "ุทุญูู ููุด (1000ุบ)", "ุทุญูู ุงุณูุฑ (1000ุบ)", "ุทุญูู ุฐุฑู (1000ุบ)", "-ุฒุนุชุฑ", "ุฒุนุชุฑ ูุญูุฌ (1000ุบ)", "ุฒุนุชุฑ ุงูุณุชุฑุง (1000ุบ)", "-ุชุฑูุณ", "ุชุฑูุณ ุญูู (1000ุบ)", "ุชุฑูุณ ูุฑ (1000ุบ)", "-ููุญ", "ููุญ ููุดูุฑ (907ุบ)", "ููุญ ุจูุดุฑู (907ุบ)", "-ูุฎุชูู", "ูุฑูู ูุฌุฑูุด (1000ุบ)", "ูุบุฑุจูู (907ุบ)", "ุฐุฑุฉ ุจูุดุงุฑ (1000ุบ)", "ุฐุฑู ูุฌุฑูุดู (1000ุบ)"], "g1k", "")

    with st.expander("๐ฆ ุชุนุจุฆุฉ 500ุบ / 454ุบ"):
        temp_sel += render_list_final(["-ุณูุณู", "ุณูุณู ููุดูุฑ", "ุณูุณู ูุญูุต", "ุณูุณู ุจูุฏู ูุญูุต", "-ูุดุงุก", "ูุดุงุก ูุงุนู", "ูุดุงุก ุญุจ", "-ุฒุนุชุฑ", "ุฒุนุชุฑ ูุญูุฌ", "ุฒุนุชุฑ ุงูุณุชุฑุง", "ุฒุนุชุฑ ุญูุจู", "-ุงูู ุนุตููุฑ", "ุจุณูุจูุณุฉ ูุดููู", "ุจุณูุจูุณู ุณุงุฏู", "ููุจุฒ", "ุฏุฎู", "ุจุฒุฑ ููุงู ุงูุดูุณ", "-ุนูุจ", "ูุบูู ุฌุงูุฒ", "ูุบูู ุจุฏูู ุณูุฑ", "ูููุจูู", "ูููุจูู ุธุฑู", "ุณุญูุจ", "ุฎูุทุฉ ูุฑุณุจู", "ุฎูุทุฉ ุจุฑูุณุชุฏ", "-ุฐุฑู", "ุฐุฑู ุจูุดุงุฑ (454ุบ)", "ุฐุฑู ูุฌุฑูุดู (500ุบ)", "-ุชุฑูุณ", "ุชุฑูุณ ุญูู (500ุบ)", "ุชุฑูุณ ูุฑ (500ุบ)", "-ุณูุฑ", "ุณูุฑ ูุงุนู", "ุณูุฑ ูุจุงุช", "ุณูุฑ ุงุณูุฑ", "-ุดููุงู", "ุดููุงู ูุจุฑูุด", "ุดููุงู ุญุจ", "-ูุฎุชูู", "ูุงุตูููุง ุนุฑูุถุฉ", "ูุฑูู ูุฌุฑูุด", "ููู ุนุฑูุถ", "ุจุฑุด ุงูููุฏ", "ุฃุฑุฒ ูุงุนู", "ูุดู", "ูููุฎูู", "ูุนู ูุทุญูู", "ุฎููุฑุฉ ุจุงููุช", "ูุงูุงู", "ุทุญูู ุฐุฑุฉ", "ุจุฒุฑ ูุชุงู"], "g500", "500ุบ")

    with st.expander("๐ฆ ุชุนุจุฆุฉ 200ุบ"):
        temp_sel += render_list_final(["-ุณูุณู", "ููุดูุฑ", "ูุญูุต", "ูุญูุต ุจูุฏู", "-ูุดุงุก", "ุญุจ", "ูุงุนู", "-ูุฑูุณูู", "ุดููููุง", "ูููู", "-ูููุฎูุฉ", "ูุงูููู", "ูุฑุชูู", "-ุฒุนุชุฑ", "ูุญูุฌ", "ุญูุจู", "-ูุฎุชูู", "ุจุฑุด ุฌูุฒ ุงูููุฏ", "ุจุงููุฉ ุฒูุฑุฉ", "ููุงูู ุนูุจ", "ูุดู ุจูุฏู", "ุจุทุงุทุง ุดูุจุณ", "ูุงูุงู", "ูุนู ูุทุญูู", "ุจุฒุฑ ูุชุงู"], "g200", "200ุบ")
    
    with st.expander("๐ ุชุนุจุฆุฉ ูุฎุชููุฉ"):
        temp_sel += render_list_final(["-ุณูุฑ ูุจุงุช", "100 ุบ ร 12", "200 ุบ ร 12", "-ููุญ", "ูุงุนู 700 ุบ ร 24", "ูุงุนู 3 ููุบ ร 6", "ุฎุดู 1 ููุบ ร 12", "-ุนูุจ", "ูุงููููุง 20 ุบ ร 12", "ุจุงูููุบ ุจูุฏุฑ 20 ุบ ร 12", "-ูุฑุชูู", "ุตููุจุฑ ร 12", "ูุณูุฉ ุญุจ ร 25", "-ุณูุณู", "ููุดูุฑ 100 ุบ ร 12", "ูุญูุต 100 ุบ ร 12", "-ุฒููุฑุงุช", "ุฒููุฑุงุช 100 ุบ ร 12", "ุฒููุฑุงุช 200 ุบ ร 12", "-ููุญ", "ููุดูุฑ 2 ููุบ", "ููุดูุฑ 5 ููุบ", "-ูุฎุชูู", "ุจุงุจููุฌ 100 ุบ ร 12", "ุจุทุงุทุง ุดูุจุณ 100 ุบ", "ุจุงููุฉ ุฒูุฑุฉ 100 ุบ", "ูุงูุงู 100 ุบ"], "gmisc", "")

    if st.button("โ ุชุซุจูุช ุฃุตูุงู ุงูุญุจูุจ"):
        st.session_state.cart.extend(temp_sel)
        st.session_state.page = 'home'; st.rerun()
    if st.button("๐ ุนูุฏุฉ"): st.session_state.page = 'home'; st.rerun()

# --- ุตูุญุฉ ุงูุจูุงุฑุงุช (ูุงููุฉ) ---
elif st.session_state.page == 'spices':
    st.markdown('<div class="header-box"><h2>๐ถ๏ธ ูููุฐุฌ ุงูุจูุงุฑุงุช</h2></div>', unsafe_allow_html=True)
    temp_s = []

    with st.expander("๐ถ๏ธ ุจูุงุฑุงุช ูุงุนูุฉ 500 ุบ"):
        temp_s += render_list_final(["-ุจูุงุฑุงุช ุฃุณุงุณูุฉ", "ุจูุงุฑ ุญูู", "ูููู ุฃุณูุฏ", "ูููู ุฃุญูุฑ", "ูุฑูุฉ", "ุณุจุน ุจูุงุฑุงุช", "ุฏูุฉ ูุนู", "ูููู", "ูุฒุจุฑุฉ", "ูุฑุงููุฉ", "ูุงุฑู", "ูุงูุณูู", "ุนูุฏุฉ ุตูุฑุงุก", "ูููููุฉ ุญููุฉ", "ุจุงุจุฑููุง", "ุซูู ูุฌูู", "ุดููุฑ", "ุฌูุฒุฉ ุงูุทูุจ", "ูุญูุจ", "ูุนูุน", "ูุฑุฏููุด", "ูุฑููู", "ูุงู", "ุฒูุฌุจูู", "ุจูุงุฑ ุฃุจูุถ", "ุนุตูุฑ", "ุตุจุบุฉ ุญูุฑุงุก", "ุดุจุฉ", "ุฎููุฌุงู", "ุญูุจุฉ", "ุฎูุทุฉ ูุฑุณุจู", "ุจุตู", "ุฒุนุชุฑ ุฃูุฑูุบุงูู", "-ุจูุงุฑุงุช ุฎุงุตุฉ", "ูุจุฉ", "ูุบุฑุจูุฉ", "ููุงูู", "ูุจุณุฉ", "ุฏุฌุงุฌ", "ุทุงููู ุฏุฌุงุฌ", "ููุงูู", "ุดุงูุฑูุง ูุญูุฉ", "ุดุงูุฑูุง ุฏุฌุงุฌ", "ููุจุฑุบุฑ", "ุณุฌู", "ููุชุฉ", "ุจูุชุฒุง", "ุงุณูุงููุจ ูุญูุฉ", "ุงุณูุงููุจ ุฏุฌุงุฌ", "ุจุณุชุฑูุง", "ุจุฑูุงูู", "ููุชูู", "ูุงููุชุง", "ูููุงุฏูููุง", "ููุณููุงูุง", "ุตููู", "ุฃุฑุฌูุชููู", "ูุฑุณุจู", "ูุฑูุณูุณูู", "ูุดุงูู", "ูุงุบุชุณ", "ุจุฑูุณุชุฏ", "ุชุดููู ุณุงุจ", "ุณูู", "ูููุฉ ุงููุงุฌู", "ูููุฉ ุงูุฌุจูุฉ"], "s5n", "500ุบ ูุงุนู")

    with st.expander("๐ฟ ุจูุงุฑุงุช ุญุจ 500 ุบ"):
        temp_s += render_list_final(["-ุจูุงุฑุงุช ุญุจ", "ุจูุงุฑ ุญูู", "ูููู ุฃุณูุฏ", "ูููู ุฃุณูุฏ ุฎุดู", "ูููู ุฃุญูุฑ ุฎุดู", "ูุฑูุฉ", "ุฏูุฉ ูุจุฉ", "ุฏูุฉ ูุจุฉ ูุฌุฑูุดุฉ", "ุฏูุฉ ููุณุง", "ูููู", "ูุฑุงููุฉ", "ูุงูุณูู", "ุฌูุฒุฉ ุงูุทูุจ", "ูุญูุจ", "ูุฑููู", "ูุงู", "ุฒูุฌุจูู", "ุฎูุทุฉ ููุณูู", "ุดููุฑ", "ุฎููุฌุงู", "ุญุจุฉ ุงูุจุฑูุฉ", "ูุฑู ุบุงุฑ", "ูููุง", "ูุฑุฏ", "ุจุงุจููุฌ", "ุญุจู", "ุฎููุฑุฉ", "ูุฒุจุฑุฉ"], "s5h", "500ุบ ุญุจ")

    with st.expander("๐ถ๏ธ ุจูุงุฑุงุช 50 ุบ"):
        temp_s += render_list_final(["-ุจูุงุฑุงุช ูุงุนูุฉ 50 ุบ", "ุจูุงุฑ ุญูู", "ูููู ุฃุณูุฏ", "ูููู ุฃุญูุฑ", "ูุฑูุฉ", "ุณุจุน ุจูุงุฑุงุช", "ุฏูุฉ ูุนู", "ูููู", "ูุฒุจุฑุฉ", "ูุฑุงููุฉ", "ูุงุฑู", "ุณูุงู", "ูุงูุณูู", "ุนูุฏุฉ ุตูุฑุงุก", "ูููููุฉ ุญููุฉ", "ุญุงูุถ", "ุซูู ูุฌูู", "ุดููุฑ", "ุฒุนุชุฑ ุฃูุฑูุบุงูู", "ุจูุชุงู", "ุจุงุจุฑููุง"], "s50", "50ุบ")
    
    with st.expander("๐ฟ ุจูุงุฑุงุช ุญุจ 20/50 ุบ"):
        temp_s += render_list_final(["-ุจูุงุฑุงุช ุญุจ 50 ุบ", "ุจูุงุฑ ุญูู", "ูููู ุฃุณูุฏ", "ูููู", "ูุฒุจุฑุฉ", "ูุงูุณูู", "ุญุจุฉ ุงูุจุฑูุฉ", "ุฎููุฑุฉ", "ุญุจู", "ูููุง", "ุฒูุฌุจูู", "ุดููุฑ", "ุญูุจุฉ"], "sh50", "50ุบ ุญุจ")
        temp_s += render_list_final(["-ุจูุงุฑุงุช ุญุจ 20 ุบ", "ุฌูุฒุฉ ุงูุทูุจ", "ูุญูุจ", "ูุฑููู", "ูุงู", "ุนุตูุฑ"], "sh20", "20ุบ ุญุจ")
    
    with st.expander("๐ ุจูุงุฑุงุช ูุงุนูุฉ 20 ุบ"):
        temp_s += render_list_final(["ุฌูุฒุฉ ุงูุทูุจ", "ูุญูุจ", "ูุนูุน", "ูุฑููู", "ูุงู", "ุฒูุฌุจูู", "ุจูุงุฑ ุฃุจูุถ", "ูุฑุฏููุด"], "sn20", "20ุบ ูุงุนู")
    
    with st.expander("๐ ุฃุตูุงู ูุชููุนุฉ / ุชุนุจุฆุฉ ูุฎุชููุฉ"):
        temp_s += render_list_final(["-ุจููุฑุจููุงุช", "ุจููุฑุจููุงุช (100 ุบ ร 12)", "ุจููุฑุจููุงุช (500 ุบ)", "ุจููุฑุจููุงุช (1000 ุบ)", "-ุญุงูุถ", "ุญุงูุถ (100 ุบ ร 12)", "ุญุงูุถ (200 ุบ ร 12)", "ุญุงูุถ (500 ุบ)", "ุญุงูุถ (1000 ุบ)", "-ุณูุงู", "ุณูุงู (200 ุบ)", "ุณูุงู (500 ุบ)", "ุณูุงู (1000 ุบ)", "-ูุงูุณูู ุญุจ", "ูุงูุณูู ุญุจ (200 ุบ)", "ูุงูุณูู ุญุจ (500 ุบ)", "ูุงูุณูู ุญุจ (1000 ุบ)", "-ุฏูุฉ ููุณุง", "ุฏูุฉ ููุณุง (100 ุบ ร 12)", "ุฏูุฉ ููุณุง (200 ุบ ร 12)", "-ุฃุตูุงู ูุชููุนุฉ", "ูุฑูุฉ ุนูุฏ (100 ุบ ร 12)", "ูุฑูุฉ ุนูุฏ (200 ุบ ร 12)", "ุฏูุฉ ูุจุฉ ุญุจ (100 ุบ ร 12)", "ูุฑู ุบุงุฑ (50 ุบ ร 12)", "ูุฑู ุบุงุฑ (10 ุบ ร 12)", "ูููุง (100 ุบ ร 12)", "ุฒุนุชุฑ ุจูุชุฒุง (50 ุบ ร 12)", "ุฎูุทุฉ ููุณูู (100 ุบ)", "ุฎูุทุฉ ููุณูู (200 ุบ)", "ุฅูููู ุงูุฌุจู (50 ุบ ร 12)"], "smisc", "")
    
    if st.button("โ ุชุซุจูุช ุฃุตูุงู ุงูุจูุงุฑุงุช"):
        st.session_state.cart.extend(temp_s)
        st.session_state.page = 'home'; st.rerun()
    if st.button("๐ ุนูุฏุฉ"): st.session_state.page = 'home'; st.rerun()

# --- ุตูุญุฉ ุตูู ุฎุงุต ---
elif st.session_state.page == 'special':
    st.markdown('<div class="header-box"><h2>๐ ุทูุจ ุตูู ุฎุงุต</h2></div>', unsafe_allow_html=True)
    sp_i = st.text_input("ุงุณู ุงูุตูู:")
    sp_p = st.text_input("ุงูุชุนุจุฆุฉ:")
    sp_q = st.text_input("ุงูุนุฏุฏ ุงููุทููุจุฉ:")
    if st.button("โ ุชุซุจูุช"):
        if sp_i and sp_q:
            f_name = f"{sp_i} ({sp_p})" if sp_p else sp_i
            st.session_state.cart.append({"item": f"ุฎุงุต: {f_name}", "qty": ar_to_en_num(sp_q)})
            st.session_state.page = 'home'; st.rerun()
    if st.button("๐ ุนูุฏุฉ"): st.session_state.page = 'home'; st.rerun()
