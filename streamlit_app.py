import streamlit as st
import urllib.parse

# --- ุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ ---
RECEIVING_NUMBER = "9613220893"
st.set_page_config(page_title="ุดุฑูุฉ ุญูุจุงูู ุฅุฎูุงู", layout="wide")

# --- ุงูุชุตููู CSS (ููุญูุงุธ ุนูู ุงูุดูู ูุงููุถูุญ) ---
st.markdown("""
    <style>
    .stApp { background-color: #0E1117; }
    .category-header { 
        background-color: #fca311; color: #1E3A8A; padding: 10px; border-radius: 5px; 
        font-weight: bold; font-size: 18px; margin-top: 20px; text-align: center;
    }
    .item-box { 
        color: white !important; font-weight: bold !important; font-size: 17px !important; 
        background-color: #1E3A8A !important; padding: 8px; border-radius: 8px; 
        text-align: right; width: 100%; display: block;
    }
    input { background-color: #ffffcc !important; color: black !important; font-weight: bold !important; font-size: 20px !important; height: 45px !important; }
    .header-box { background-color: #1E3A8A; color: white; text-align: center; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
    .stButton button { background-color: #fca311; color: #1E3A8A !important; font-weight: bold; height: 50px; width: 100%; font-size: 18px; }
    </style>
    """, unsafe_allow_html=True)

if 'page' not in st.session_state: st.session_state.page = 'home'
if 'cart' not in st.session_state: st.session_state.cart = []

def ar_to_en_num(text):
    return text.translate(str.maketrans('ููกูขูฃูคูฅูฆูงูจูฉ', '0123456789'))

def render_section(items_dict, key_prefix):
    current_selections = []
    for display_name, billing_name in items_dict.items():
        if display_name.startswith("-"):
            st.markdown(f'<div class="category-header">{display_name[1:]}</div>', unsafe_allow_html=True)
        else:
            col1, col2 = st.columns([3, 1])
            with col1: st.markdown(f'<div class="item-box">{display_name}</div>', unsafe_allow_html=True)
            with col2:
                qty = st.text_input("", key=f"{key_prefix}_{display_name}", label_visibility="collapsed", placeholder="0")
                if qty:
                    en_qty = ar_to_en_num(qty)
                    if en_qty.isdigit() and int(en_qty) > 0:
                        current_selections.append({"item": billing_name, "qty": en_qty})
    return current_selections

# --- ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ---
if st.session_state.page == 'home':
    st.markdown('<div class="header-box"><h1>ูุธุงู ุทูุจูุงุช ุญูุจุงูู ุฅุฎูุงู</h1></div>', unsafe_allow_html=True)
    
    if st.session_state.cart:
        st.write("### ๐ ุงูุฃุตูุงู ุงููุฎุชุงุฑุฉ:")
        for entry in st.session_state.cart: st.write(f"โ {entry['item']} : {entry['qty']}")
        if st.button("๐ ุฅุฑุณุงู ุงูุทูุจูุฉ ุนุจุฑ ูุงุชุณุงุจ"):
            order_text = "ุทูุจูุฉ ูุจูุนุงุช ุฌุฏูุฏุฉ:\n" + "\n".join([f"โข {e['item']} : {e['qty']}" for e in st.session_state.cart])
            whatsapp_url = f"https://api.whatsapp.com/send?phone={RECEIVING_NUMBER}&text={urllib.parse.quote(order_text)}"
            st.markdown(f'<a href="{whatsapp_url}" target="_blank" style="text-decoration:none;"><button style="width:100%; background-color:#25d366; color:white; padding:15px; border-radius:10px; border:none; font-weight:bold; font-size:20px;">ุชุฃููุฏ ููุชุญ ูุงุชุณุงุจ โ</button></a>', unsafe_allow_html=True)
        if st.button("๐๏ธ ูุณุญ ุงููู"): st.session_state.cart = []; st.rerun()

    st.markdown("---")
    if st.button("๐พ ูุณู ุงูุญุจูุจ (1000ุบ / 907ุบ)"): st.session_state.page = 'grains'; st.rerun()
    if st.button("๐ถ๏ธ ูุณู ุงูุจูุงุฑุงุช (50ุบ / 20ุบ)"): st.session_state.page = 'spices'; st.rerun()

# --- ุตูุญุฉ ุงูุญุจูุจ (ุชุบุทูุฉ ูุงููุฉ ููุตูุฑ) ---
elif st.session_state.page == 'grains':
    st.markdown('<div class="header-box"><h2>๐พ ูุงุฆูุฉ ุงูุญุจูุจ</h2></div>', unsafe_allow_html=True)
    grains_list = {
        "- ุงูุญูุต ูุงูููู": "",
        "ุญูุต ูุญูู 12": "ุญูุต ูุญูู\"12\"907ุบ", "ุญูุต ูุญูู 9": "ุญูุต ูุญูู\"9\"907ุบ", "ุญูุต ูุณุฑ": "ุญูุต ูุณุฑ 1000ุบ",
        "ููู ุญุจ": "ููู ุญุจ 1000ุบ", "ููู ูุฌุฑูุด": "ููู ูุฌุฑูุด 1000ุบ", "ููู ุนุฑูุถ": "ููู ุนุฑูุถ 1000ุบ",
        "- ุงููุงุตูููุง": "",
        "ูุงุตูููุง ุตููุจุฑูุฉ": "ูุงุตูููุง ุตููุจุฑูุฉ 907ุบ", "ูุงุตูููุง ุญูุฑุง ุทูููุฉ": "ูุงุตูููุง ุญูุฑุง ุทูููุฉ 1000ุบ",
        "ูุงุตูููุง ุญูุฑุง ูุฏุนุจูุฉ": "ูุงุตูููุง ุญูุฑุง ูุฏุนุจูุฉ 1000ุบ", "ูุงุตูููุง ุนุฑูุถุฉ": "ูุงุตูููุง ุนุฑูุถุฉ 1000ุบ",
        "- ุงูุนุฏุณ": "",
        "ุนุฏุณ ุฃุจูุถ ุจูุฏู": "ุนุฏุณ ุฃุจูุถ ุจูุฏู 907ุบ", "ุนุฏุณ ุฃุญูุฑ": "ุนุฏุณ ุฃุญูุฑ 907ุบ", "ุนุฏุณ ุฃุญูุฑ ููุฑุฏู": "ุนุฏุณ ุฃุญูุฑ ููุฑุฏู 1000ุบ",
        "ุนุฏุณ ุนุฑูุถ": "ุนุฏุณ ุนุฑูุถ 907ุบ", "ุนุฏุณ ูุฌุฑูุด": "ุนุฏุณ ูุฌุฑูุด 907ุบ",
        "- ุงูุจุฑุบู ูุงูุฃุฑุฒ": "",
        "ุจุฑุบู ุฃุณูุฑ ูุงุนู": "ุจุฑุบู ุฃุณูุฑ ูุงุนู 907ุบ", "ุจุฑุบู ุฃุณูุฑ ุฎุดู": "ุจุฑุบู ุฃุณูุฑ ุฎุดู 907ุบ",
        "ุจุฑุบู ุฃุจูุถ ูุงุนู": "ุจุฑุบู ุฃุจูุถ ูุงุนู 1000ุบ", "ุจุฑุบู ุฃุจูุถ ุฎุดู": "ุจุฑุบู ุฃุจูุถ ุฎุดู 907ุบ",
        "ุฃุฑุฒ ุฃูุฑููู": "ุฃุฑุฒ ุฃูุฑููู 907ุบ", "ุฃุฑุฒ ุฅูุทุงูู": "ุฃุฑุฒ ุฅูุทุงูู 907ุบ", "ุฃุฑุฒ ูุตุฑู": "ุฃุฑุฒ ูุตุฑู 907ุบ",
        "ุฃุฑุฒ ูุงุนู": "ุฃุฑุฒ ูุงุนู 1000ุบ", "ุฃุฑุฒ ุจุณูุชู": "ุฃุฑุฒ ุจุณูุชู 907ุบ", "ุฃุฑุฒ ุนูุจุฑู": "ุฃุฑุฒ ุนูุจุฑู 1000ุบ",
        "- ุงูุณูุฑ ูุงูุทุญูู": "",
        "ุณูุฑ ุฃุณูุฑ": "ุณูุฑ ุฃุณูุฑ 1000ุบ", "ุณูุฑ ุญุจ": "ุณูุฑ ุญุจ 907ุบ", "ุณูุฑ ูุงุนู": "ุณูุฑ ูุงุนู 1000ุบ",
        "ุทุญูู ุฒูุฑู": "ุทุญูู ุฒูุฑู 1000ุบ", "ุทุญูู ุบูุฏ ููุฏู": "ุทุญูู ุบูุฏ ููุฏู 1ู", "ุทุญูู ุบูุฏ ูุงุฑู": "ุทุญูู ุบูุฏ ูุงุฑู 907ุบ",
        "ุทุญูู ููุด": "ุทุญูู ููุด 1000ุบ", "ุทุญูู ุฃุณูุฑ": "ุทุญูู ุฃุณูุฑ 1000ุบ", "ุทุญูู ุฐุฑุฉ": "ุทุญูู ุฐุฑุฉ 1000ุบ",
        "ุทุญูู ูุฑุฎุฉ": "ุทุญูู ูุฑุฎุฉ 907ุบ", "ุณููุฏ": "ุณููุฏ 907ุบ",
        "- ุฃุตูุงู ูุชููุนุฉ": "",
        "ููุญ ููุดูุฑ": "ููุญ ููุดูุฑ 907ุบ", "ุชุฑูุณ ุญูู": "ุชุฑูุณ ุญูู 1000ุบ", "ุฐุฑุฉ ุจูุดุงุฑ": "ุฐุฑุฉ ุจูุดุงุฑ 1000ุบ",
        "ูุดู ุจูุฏู": "*ูุดู ุจูุฏู 1000ุบ", "ูุงููููุง": "*ูุงููููุง 1000ุบ", "ุจุงููุบ ุจูุฏุฑ": "*ุจุงููุบ ุจูุฏุฑ 1000ุบ",
        "ูุดุงุก ูุงุนู": "ูุดุงุก ูุงุนู 1000ุบ", "ูุนู ูุทุญูู": "*ูุนู ูุทุญูู 1000ุบ", "ูุฑูู ูุฌุฑูุด": "*ูุฑูู ูุฌุฑูุด 1000ุบ"
    }
    res = render_section(grains_list, "gr")
    if st.button("โ ุญูุธ"): st.session_state.cart.extend(res); st.session_state.page = 'home'; st.rerun()
    if st.button("๐ ุนูุฏุฉ"): st.session_state.page = 'home'; st.rerun()

# --- ุตูุญุฉ ุงูุจูุงุฑุงุช (ูู ุณุทุฑ 126 ุฅูู 241) ---
elif st.session_state.page == 'spices':
    st.markdown('<div class="header-box"><h2>๐ถ๏ธ ูุงุฆูุฉ ุงูุจูุงุฑุงุช ุงููุงููุฉ</h2></div>', unsafe_allow_html=True)
    
    # 50g Section (126 - 228)
    spices_50g = {
        "- ุจูุงุฑุงุช 50ุบ (ุฏุฒููุฉ*12)": "",
        "ุจูุงุฑ ุญูู": "*ุจูุงุฑ ุญูู 50ุบ*12", "ูููู ุฃุณูุฏ": "*ูููู ุฃุณูุฏ 50ุบ*12", "ูููู ุฃุญูุฑ": "*ูููู ุฃุญูุฑ 50ุบ*12",
        "ูุฑูุฉ ูุงุนูุฉ": "*ูุฑูุฉ ูุงุนูุฉ 50ุบ*12", "ุณุจุน ุจูุงุฑุงุช": "*ุณุจุน ุจูุงุฑุงุช 50ุบ*12", "ุนูุฏุฉ ุตูุฑุฉ": "*ุนูุฏุฉ ุตูุฑุฉ 50ุบ*12",
        "ูููู": "*ูููู 50ุบ*12", "ูุฒุจุฑุฉ": "*ูุฒุจุฑุฉ 50ุบ*12", "ูุงูุณูู": "*ูุงูุณูู 50ุบ*12", "ุณูุงู": "*ุณูุงู 50ุบ*12",
        "ุญุงูุถ": "*ุญุงูุถ 50ุบ*12", "ุจูุงุฑ ุฏุฌุงุฌ": "*ุจูุงุฑ ุฏุฌุงุฌ 50ุบ*12", "ุจูุงุฑ ุทุงููู": "*ุจูุงุฑ ุทุงููู 50ุบ*12",
        "ุจูุงุฑ ูุจุณุฉ": "*ุจูุงุฑ ูุจุณุฉ 50ุบ*12", "ุจูุงุฑ ููุงูู": "*ุจูุงุฑ ููุงูู 50ุบ*12", "ุจูุงุฑ ุดูุฑูุง ูุญู": "*ุจูุงุฑ ุดูุฑูุง ูุญู 50ุบ*12",
        "ุจูุงุฑ ุดูุฑูุง ุฏุฌุง": "*ุจูุงุฑ ุดูุฑูุง ุฏุฌุง 50ุบ*12ุฌ", "ุจูุงุฑ ููููุจุฉ": "*ุจูุงุฑ ููููุจุฉ 50ุบ*12", 
        "ุจูุงุฑ ูุฏุฎู": "*ุจูุงุฑ ูุฏุฎู 50ุบ*12", "ุจูุงุฑ ูุงูุฏู": "*ุจูุงุฑูุงูุฏู 50ุบ*12", "ุจุงุจุฑููุง ูุฏุฎู": "*ุจุงุจุฑููุง ูุฏุฎู 50ุบ*12",
        "ุจูุงุฑ ุฌุจูุฉ ุตุงูู": "*ุจูุงุฑ ุฌุจูุฉ ุตุงูู 50ุบ*12", "ุจูุงุฑ ุญูู ุญุจ": "*ุจูุงุฑ ุญูู ุญุจ 50ุบ*12",
        "ูููู ุฃุณูุฏ ุญุจ": "*ูููู ุฃุณูุฏ ุญุจ 50ุบ*12", "ูููู ุญุจ": "*ูููู ุญุจ 50ุบ*12", "ูุฒุจุฑุฉ ุญุจ": "*ูุฒุจุฑุฉ ุญุจ 50ุบ*12",
        "ูุงูุณูู ุญุจ": "*ูุงูุณูู ุญุจ 50ุบ*12", "ุญุจุฉ ุงูุจุฑูุฉ ุญุจ": "*ุญุจุฉ ุงูุจุฑูุฉ ุญุจ 50ุบ*12", "ูููุง": "*ูููุง 50ุบ*12",
        "ุญูุจุฉ ุญุจ": "*ุญูุจุฉ ุญุจ 50ุบ*12", "ุฒูุฌุจูู ุญุจ": "*ุฒูุฌุจูู ุญุจ 50ุบ*12", "ุญุจู": "*ุญุจู 50ุบ*12"
    }
    
    # 20g Section (229 - 241)
    spices_20g = {
        "- ุจูุงุฑุงุช 20ุบ (ุฏุฒููุฉ*12)": "",
        "ุฌูุฒ ุงูุทูุจ ูุงุนู": "*ุฌูุฒ ุงูุทูุจ ูุงุนู 20ุบ*12", "ูุญูุจ ูุงุนู": "*ูุญูุจ ูุงุนู 20ุบ*12", "ูุนูุน ูุงุจุณ": "*ูุนูุน ูุงุจุณ 20ุบ*12",
        "ูุฑุฏููุด": "*ูุฑุฏููุด 20ุบ*12", "ูุฑููู ูุงุนู": "*ูุฑููู ูุงุนู 20ุบ*12", "ุจูุงุฑ ุฃุจูุถ ูุงุนู": "*ุจูุงุฑ ุฃุจูุถ ูุงุนู 20ุบ*12",
        "ูุงู ูุงุนู": "*ูุงู ูุงุนู 20ุบ*12", "ุฒูุฌุจูู ูุงุนู": "*ุฒูุฌุจูู ูุงุนู 20ุบ*12", "ุฌูุฒ ุงูุทูุจ ุญุจ": "*ุฌูุฒ ุงูุทูุจ ุญุจ 20ุบ*12",
        "ูุญูุจ ุญุจ": "*ูุญูุจ ุญุจ 20ุบ*12", "ูุฑููู ุญุจ": "*ูุฑููู ุญุจ 20ุบ*12", "ูุงู ุญุจ": "*ูุงู ุญุจ 20ุบ*12", "ุนุตูุฑ": "*ุนุตูุฑ 20ุบ*12"
    }

    res = render_section(spices_50g, "s50") + render_section(spices_20g, "s20")
    if st.button("โ ุญูุธ"): st.session_state.cart.extend(res); st.session_state.page = 'home'; st.rerun()
    if st.button("๐ ุนูุฏุฉ"): st.session_state.page = 'home'; st.rerun()
